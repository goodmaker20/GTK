<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Weather Checker</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    input, button {
      padding: 8px;
      margin-top: 10px;
    }
    #weather-result {
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 10px;
    }
    #map {
      height: 300px;
      margin-top: 20px;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <h1>‚òÄÔ∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</h1>
  <input type="text" id="city-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô Bangkok">
  <button onclick="getWeatherByCity()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>

  <div id="weather-result"></div>
  <div id="map"></div>

  <p><a href="../projects.html">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö</a></p>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const apiKey = "53ac4b3174c395bfe31abd3f8b5e1e16"; // üîë ‡πÅ‡∏Å‡πÑ‡∏õ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡πà‡∏¢‡∏ô API Key ‡∏à‡∏≤‡∏Å OpenWeatherMap
    const weatherResult = document.getElementById("weather-result");
    let map, marker;

    function displayMap(lat, lon) {
      if (!map) {
        map = L.map('map').setView([lat, lon], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Map data ¬© <a href="https://openstreetmap.org">OpenStreetMap</a>'
        }).addTo(map);
        marker = L.marker([lat, lon]).addTo(map);
      } else {
        map.setView([lat, lon], 10);
        marker.setLatLng([lat, lon]);
      }
    }

    function displayWeather(data) {
      weatherResult.innerHTML = `
        <h3>${data.name}, ${data.sys.country}</h3>
        <p>üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: ${data.main.temp} ¬∞C</p>
        <p>‚òÅÔ∏è ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®: ${data.weather[0].description}</p>
        <p>üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${data.main.humidity}%</p>
        <p>üå¨Ô∏è ‡∏•‡∏°: ${data.wind.speed} m/s</p>
      `;
      displayMap(data.coord.lat, data.coord.lon);
    }

    function getWeatherByCity() {
      const city = document.getElementById("city-input").value;
      if (!city) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á");
        return;
      }
      fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=th`)
        .then(res => res.json())
        .then(data => {
          if (data.cod === 200) {
            displayWeather(data);
          } else {
            weatherResult.innerHTML = `<p style='color:red;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏µ‡πâ</p>`;
          }
        })
        .catch(err => {
          weatherResult.innerHTML = `<p style='color:red;'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err}</p>`;
        });
    }

    function getWeatherByLocation(lat, lon) {
      fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=th`)
        .then(res => res.json())
        .then(data => {
          if (data.cod === 200) {
            displayWeather(data);
          } else {
            weatherResult.innerHTML = `<p style='color:red;'>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ô‡∏µ‡πâ</p>`;
          }
        })
        .catch(err => {
          weatherResult.innerHTML = `<p style='color:red;'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err}</p>`;
        });
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏û‡∏à
    window.onload = () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          const { latitude, longitude } = position.coords;
          getWeatherByLocation(latitude, longitude);
        }, err => {
          weatherResult.innerHTML = `<p style='color:red;'>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>`;
        });
      } else {
        weatherResult.innerHTML = `<p style='color:red;'>‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</p>`;
      }
    }
  </script>
</body>
</html>
